<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>3.4&nbsp;Time to Make the Donuts</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default"/><link rel="stylesheet" type="text/css" href="course.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Operating Systems (Spring 2016)</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="index.html#%28part._.Introduction%29" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="index.html#%28part._.Lectures%29" class="tocviewlink" data-pltdoc="x">Lectures</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="index.html#%28part._assignments%29" class="tocviewselflink" data-pltdoc="x">Assignments</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="index.html#%28part._turnin%29" class="tocviewlink" data-pltdoc="x">Turn-<wbr></wbr>In and Grading</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="index.html#%28part._.Help%29" class="tocviewlink" data-pltdoc="x">Help</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="index.html#%28part._.Readings%29" class="tocviewlink" data-pltdoc="x">Readings</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="index.html#%28part._software%29" class="tocviewlink" data-pltdoc="x">Software</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="index.html#%28part._.Fine_.Print%29" class="tocviewlink" data-pltdoc="x">Fine Print</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>3&nbsp;</td><td><a href="index.html#%28part._assignments%29" class="tocviewlink" data-pltdoc="x">Assignments</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="a1.html" class="tocviewlink" data-pltdoc="x">Basic Processes</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="a2.html" class="tocviewlink" data-pltdoc="x">Interprocess Communication</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="exam1.html" class="tocviewlink" data-pltdoc="x">Exam 1</a></td></tr><tr><td align="right">3.4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Time to Make the Donuts</a></td></tr><tr><td align="right">3.5&nbsp;</td><td><a href="a4.html" class="tocviewlink" data-pltdoc="x">World Donutination</a></td></tr><tr><td align="right">3.6&nbsp;</td><td><a href="exam2.html" class="tocviewlink" data-pltdoc="x">Exam 2</a></td></tr><tr><td align="right">3.7&nbsp;</td><td><a href="a5.html" class="tocviewlink" data-pltdoc="x">Memory Management Simulator</a></td></tr><tr><td align="right">3.8&nbsp;</td><td><a href="a6.html" class="tocviewlink" data-pltdoc="x"><span class="RktSym">ls</span><span class="RktMeta"></span></a></td></tr><tr><td align="right">3.9&nbsp;</td><td><a href="final.html" class="tocviewlink" data-pltdoc="x">Final</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="exam1.html" title="backward to &quot;3.3 Exam 1&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html#%28part._assignments%29" title="up to &quot;3 Assignments&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="a4.html" title="forward to &quot;3.5 World Donutination&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>3.4<tt>&nbsp;</tt><a name="(part._a3)"></a>Time to Make the Donuts</h4><p>In C using UNIX system calls, demonstrate a producer-consumer
network. The produce makes donuts and the consumers eat them by the
dozens. Yum!</p><p>Your program will receive the following command-line arguments:
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">PM</span><span class="hspace"></span></span> (a production mode), <span class="RktInBG"><span class="hspace"></span><span class="RktIn">DC</span><span class="hspace"></span></span> (donut type count),
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">CC</span><span class="hspace"></span></span> (a consumer count), <span class="RktInBG"><span class="hspace"></span><span class="RktIn">DDC</span><span class="hspace"></span></span> (a donut dozen count),
and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">QS</span><span class="hspace"></span></span> (a queue size).</p><p>Your program will create a shared memory
segment (<a href="http://linux.die.net/man/7/shm_overview"><span class="RktSym">man</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">shm_overview</span><span class="RktMeta"></span></a>), spawn one <a href="#%28tech._producer%29" class="techoutside" data-pltdoc="x"><span class="techinside">producer</span></a> process, then spawn
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">CC</span><span class="hspace"></span></span> <a href="#%28tech._consumer%29" class="techoutside" data-pltdoc="x"><span class="techinside">consumer</span></a> processes. The shared memory segment
should contain <span class="RktInBG"><span class="hspace"></span><span class="RktIn">DC</span><span class="hspace"></span></span> queues of size <span class="RktInBG"><span class="hspace"></span><span class="RktIn">QS</span><span class="hspace"></span></span>, one for each
of the donut types. The queue should have
semaphores (<a href="http://linux.die.net/man/2/semget"><span class="RktSym">man</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">semget</span><span class="RktMeta"></span></a>) for locking and a ring buffer array for storing the
values. Your program should kill the <a href="#%28tech._producer%29" class="techoutside" data-pltdoc="x"><span class="techinside">producer</span></a> when all the
<a href="#%28tech._consumer%29" class="techoutside" data-pltdoc="x"><span class="techinside">consumer</span></a> processes exit.</p><p>Your <a name="(tech._producer)"></a><span style="font-style: italic">producer</span> process should endlessly produce donuts. If
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">PM</span><span class="hspace"></span></span> is <span class="RktInBG"><span class="hspace"></span><span class="RktIn">in-order</span><span class="hspace"></span></span>, it should produce one donut of
each of the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">DC</span><span class="hspace"></span></span> types in sequence. If <span class="RktInBG"><span class="hspace"></span><span class="RktIn">PM</span><span class="hspace"></span></span> is
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">rand</span><span class="hspace"></span></span>, it should randomly determine which type of donut to
produce. In this context, to produce donut #<span class="RktInBG"><span class="hspace"></span><span class="RktIn">n</span><span class="hspace"></span></span> of type
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">ty</span><span class="hspace"></span></span> means to put the integer <span class="RktInBG"><span class="hspace"></span><span class="RktIn">n</span><span class="hspace"></span></span> into the queue for
type <span class="RktInBG"><span class="hspace"></span><span class="RktIn">ty</span><span class="hspace"></span></span>.</p><p>Your <a name="(tech._consumer)"></a><span style="font-style: italic">consumer</span> processes should consume <span class="RktInBG"><span class="hspace"></span><span class="RktIn">DDC</span><span class="hspace"></span></span> dozen
donuts. To consume a donut of type <span class="RktInBG"><span class="hspace"></span><span class="RktIn">ty</span><span class="hspace"></span></span> means to read the
integer at the next slot in the queue for type <span class="RktInBG"><span class="hspace"></span><span class="RktIn">ty</span><span class="hspace"></span></span>. When
consumer <span class="RktInBG"><span class="hspace"></span><span class="RktIn">i</span><span class="hspace"></span></span> finishes consuming dozen <span class="RktInBG"><span class="hspace"></span><span class="RktIn">j</span><span class="hspace"></span></span>, the
consumer should display a line formatted as <span class="RktInBG"><span class="hspace"></span><span class="RktIn">(yum i j ([ty di] ...))</span><span class="hspace"></span></span> where <span class="RktInBG"><span class="hspace"></span><span class="RktIn">ty</span><span class="hspace"></span></span> is the donut type and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">di</span><span class="hspace"></span></span> is the
donut identifier. Your consumers should consume donuts in an order
determined by <span class="RktInBG"><span class="hspace"></span><span class="RktIn">PM</span><span class="hspace"></span></span> in the same way as
<a href="#%28tech._producer%29" class="techoutside" data-pltdoc="x"><span class="techinside">producer</span></a> (i.e. ordered or randomized).</p><p>Your program should have no other output than mentioned above.</p><p>You must use your program in a <a href="#%28tech._test%29" class="techoutside" data-pltdoc="x"><span class="techinside">test</span></a> and an <a href="#%28tech._experiment%29" class="techoutside" data-pltdoc="x"><span class="techinside">experiment</span></a>.</p><p>For the <a name="(tech._test)"></a><span style="font-style: italic">test</span>, discover a set of command-line arguments to
the program that produces deterministic output. Your <span class="RktSym">README</span><span class="RktMeta"></span>
should include this output, clearly labeled.</p><p>For the <a name="(tech._experiment)"></a><span style="font-style: italic">experiment</span>, run your program with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">rand 4 5 10 50</span><span class="hspace"></span></span> as arguments. Your <span class="RktSym">README</span><span class="RktMeta"></span> should include this output,
clearly labeled. After this, produce a graph showing the probability
of deadlock versus varying <span class="RktInBG"><span class="hspace"></span><span class="RktIn">QS</span><span class="hspace"></span></span> arguments. The graph should be
ASCII art and based on a few different runs for each
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">QS</span><span class="hspace"></span></span>. Next, using the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">QS</span><span class="hspace"></span></span> argument that produces 50%
deadlocks, vary the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">CC</span><span class="hspace"></span></span> argument from 1 to 10 and graph the
results. Your <span class="RktSym">README</span><span class="RktMeta"></span> does not need the output for these
experiments, only the graphs.</p><p>Your repository must contain the following files:</p><ul><li><p>A <span class="RktSym">README</span><span class="RktMeta"></span> file that contains a short write-up of your
project. It should discuss the approach you took to solving the
problem, it should discuss any problems or issues that still remain,
it should discuss any interesting things that you learned in the
course of the project. Finally, it should provide the grade you
believe the project deserves with a detailed explanation of why. This
explanation should almost certainly focus on why you believe the
program is correct.</p><p>Your <span class="RktSym">README</span><span class="RktMeta"></span> must contain the results of your <a href="#%28tech._experiment%29" class="techoutside" data-pltdoc="x"><span class="techinside">experiment</span></a>
and your <a href="#%28tech._test%29" class="techoutside" data-pltdoc="x"><span class="techinside">test</span></a>.</p><p>This file must be in plain-text. If you need formatting, use
Markdown. It must be limited to 80 characters wide, unless you are
quoting program output.</p></li><li><p>Your source code, named <span class="RktSym">a3.c</span><span class="RktMeta"></span>.</p></li><li><p>A <span class="RktSym">Makefile</span><span class="RktMeta"></span> builds the program and runs the <a href="#%28tech._test%29" class="techoutside" data-pltdoc="x"><span class="techinside">test</span></a>.</p></li></ul><p>This assignment will be graded based on its correctness and your
ability to articulate why it is correct.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="exam1.html" title="backward to &quot;3.3 Exam 1&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html#%28part._assignments%29" title="up to &quot;3 Assignments&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="a4.html" title="forward to &quot;3.5 World Donutination&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>