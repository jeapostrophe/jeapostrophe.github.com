<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>3.5&nbsp;MIC-1 Microcode Extension</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default"/><link rel="stylesheet" type="text/css" href="course.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Computer Architecture (Fall 2015)</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="index.html#%28part._.Introduction%29" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="index.html#%28part._.Lectures%29" class="tocviewlink" data-pltdoc="x">Lectures</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="index.html#%28part._assignments%29" class="tocviewselflink" data-pltdoc="x">Assignments</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="index.html#%28part._turnin%29" class="tocviewlink" data-pltdoc="x">Turn-<wbr></wbr>In and Grading</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="index.html#%28part._.Help%29" class="tocviewlink" data-pltdoc="x">Help</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="index.html#%28part._.Readings%29" class="tocviewlink" data-pltdoc="x">Readings</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="index.html#%28part._software%29" class="tocviewlink" data-pltdoc="x">Software</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="index.html#%28part._.Fine_.Print%29" class="tocviewlink" data-pltdoc="x">Fine Print</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>3&nbsp;</td><td><a href="index.html#%28part._assignments%29" class="tocviewlink" data-pltdoc="x">Assignments</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="a1.html" class="tocviewlink" data-pltdoc="x">Floating Point Representation</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="a2.html" class="tocviewlink" data-pltdoc="x">DIY Floating Point Addition</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="a3.html" class="tocviewlink" data-pltdoc="x">MIC-<wbr></wbr>1 Fibonacci</a></td></tr><tr><td align="right">3.4&nbsp;</td><td><a href="exam1.html" class="tocviewlink" data-pltdoc="x">Exam 1</a></td></tr><tr><td align="right">3.5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">MIC-<wbr></wbr>1 Microcode Extension</a></td></tr><tr><td align="right">3.6&nbsp;</td><td><a href="a5.html" class="tocviewlink" data-pltdoc="x">MIC-<wbr></wbr>1 Calculator</a></td></tr><tr><td align="right">3.7&nbsp;</td><td><a href="exam2.html" class="tocviewlink" data-pltdoc="x">Exam 2</a></td></tr><tr><td align="right">3.8&nbsp;</td><td><a href="a6.html" class="tocviewlink" data-pltdoc="x">MIC-<wbr></wbr>1 Linker</a></td></tr><tr><td align="right">3.9&nbsp;</td><td><a href="a7.html" class="tocviewlink" data-pltdoc="x">UNIX Processes</a></td></tr><tr><td align="right">3.10&nbsp;</td><td><a href="e1.html" class="tocviewlink" data-pltdoc="x">Cache Simulator</a></td></tr><tr><td align="right">3.11&nbsp;</td><td><a href="final.html" class="tocviewlink" data-pltdoc="x">Final</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="exam1.html" title="backward to &quot;3.4 Exam 1&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html#%28part._assignments%29" title="up to &quot;3 Assignments&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="a5.html" title="forward to &quot;3.6 MIC-1 Calculator&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>3.5<tt>&nbsp;</tt><a name="(part._a4)"></a>MIC-1 Microcode Extension</h4><p>In MIC-1 microcode, write a new MIC-1 assembly interpreter that
supports three additional instructions and changes the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">HALT</span><span class="hspace"></span></span>
instruction.</p><p>In C, modify the
<a href="https://github.com/jeapostrophe/mic1/tree/master/masm">MIC-1
assembler</a> to produce MIC-1 object files for this modified instruction
set.</p><p><div class="SIntrapara">The details of the opcodes you must support in both are as follows:
</div><div class="SIntrapara"><ul><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">MULT</span><span class="hspace"></span></span> - <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111111 1 00 mmmmmm</span><span class="hspace"></span></span> - multiply the
signed value at the top of the stack by the 6-bit immediate unsigned
value <span class="RktInBG"><span class="hspace"></span><span class="RktIn">mmmmmm</span><span class="hspace"></span></span>. The result of the multiplication should
replace the value at the top of the stack, provided that no overflow
occurred. If the multiplication would overflow a 16-bit result, the
top of the stack must not be changed. After the operation, the
accumulator must be set to 0 if the multiplication succeeded, and -1
if an overflow occurred.</p></li><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">RSHIFT</span><span class="hspace"></span></span> - <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111111 1 01 ??ssss</span><span class="hspace"></span></span> - right shift
the current signed accumulator by the 4-bit immediate unsigned value
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">ssss</span><span class="hspace"></span></span>. This is a zero-fill operation. The <span class="RktInBG"><span class="hspace"></span><span class="RktIn">??</span><span class="hspace"></span></span> bits
are ignored.</p></li><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">DIV</span><span class="hspace"></span></span> - <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111111 1 10 ??????</span><span class="hspace"></span></span> - divide the
16-bit signed number at the top stack location (<span class="RktInBG"><span class="hspace"></span><span class="RktIn">SP</span><span class="hspace"></span></span>) by the
16-bit signed number at the location just under the top stack
location (<span class="RktInBG"><span class="hspace"></span><span class="RktIn">SP+1</span><span class="hspace"></span></span>) and push on two new locations the signed
remainder and signed quotient. The remainder should be at
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">SP-1</span><span class="hspace"></span></span> and the quotient should be at <span class="RktInBG"><span class="hspace"></span><span class="RktIn">SP-2</span><span class="hspace"></span></span>. If the
divisor is equal to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span>, the remainder should be set to
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">-1</span><span class="hspace"></span></span> and the quotient should be set to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span>. After the
operation, the accumulator must be set to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> if the division
was legal, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">-1</span><span class="hspace"></span></span> if an attempt to divide by
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span>. Legal divisions should satisfy the equations
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">dividend = divisor * quotient + remainder</span><span class="hspace"></span></span>,
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">abs(remainder) &lt; abs(divisor)</span><span class="hspace"></span></span>, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">sign(remainder) = sign(dividend)</span><span class="hspace"></span></span>. The <span class="RktInBG"><span class="hspace"></span><span class="RktIn">??????</span><span class="hspace"></span></span> bits are ignored.</p></li><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">HALT</span><span class="hspace"></span></span> - <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111111 1 11 ??????</span><span class="hspace"></span></span> - halt the
processor. The <span class="RktInBG"><span class="hspace"></span><span class="RktIn">??????</span><span class="hspace"></span></span> bits are ignored.</p></li></ul></div></p><p>There are three example assembly programs that use these new
instructions. You will need to use these as tests. The links are as
follows:
<a href="../notes/dist/a4_div_test.asm"><span class="RktSym">a4_div_test.asm</span><span class="RktMeta"></span></a>,
<a href="../notes/dist/a4_mult_test.asm"><span class="RktSym">a4_mult_test.asm</span><span class="RktMeta"></span></a>, and
<a href="../notes/dist/a4_rshift_test.asm"><span class="RktSym">a4_rshift_test.asm</span><span class="RktMeta"></span></a>.</p><p><div class="SIntrapara">You must turn in
</div><div class="SIntrapara"><ul><li><p>A <span class="RktSym">README</span><span class="RktMeta"></span> file that contains a short write-up of your
project. It should discuss the approach you took to solving the
problem, it should discuss any problems or issues that still remain,
it should discuss any interesting things that you learned in the
course of the project. Finally, it should provide the grade you
believe the project deserves with a detailed explanation of why. This
explanation should almost certainly focus on why you believe the
program is correct.</p><p>This file must be in plain-text. If you need formatting, use
Markdown. It must be limited to 80 characters wide, unless you are
quoting program output.</p></li><li><p>Your microcode source, named <span class="RktSym">rmd.mc</span><span class="RktMeta"></span>.</p></li><li><p>Your compiled microcode, named <span class="RktSym">rmd.prom</span><span class="RktMeta"></span>.</p></li><li><p>Your modified <span class="RktSym">masm</span><span class="RktMeta"></span> source directory that starts as a copy
of the
<a href="https://github.com/jeapostrophe/mic1/tree/master/masm">online
version</a> and contains the same number of files, with the same names,
but with different contents that you write to support the new
instructions.</p></li><li><p>Three test input files, named <span class="RktSym">div.in</span><span class="RktMeta"></span>, <span class="RktSym">mult.in</span><span class="RktMeta"></span>, and
<span class="RktSym">rshift.in</span><span class="RktMeta"></span>, that contains debugger input to the three test
assembly programs to show that your microcode is implemented
correctly.</p></li><li><p>Three test output files, named <span class="RktSym">div.out</span><span class="RktMeta"></span>, <span class="RktSym">mult.out</span><span class="RktMeta"></span>,
and <span class="RktSym">rshift.out</span><span class="RktMeta"></span>, that contains the expected output for the test
input files.</p></li><li><p>A <span class="RktSym">Makefile</span><span class="RktMeta"></span> that builds the modified microcode, builds the
modified assembler, builds the test object files, and then tests them
by running them with the corresponding <span class="RktSym">.in</span><span class="RktMeta"></span> files as input and
compares the actual output to corresponding <span class="RktSym">.out</span><span class="RktMeta"></span> files. You may
assume that the <span class="RktSym">mcc</span><span class="RktMeta"></span> and <span class="RktSym">mic1</span><span class="RktMeta"></span> binaries are in the
<span class="RktSym">PATH</span><span class="RktMeta"></span>.</p></li></ul></div></p><p>This assignment will be graded based on its correctness and your
ability to articulate why it is correct.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="exam1.html" title="backward to &quot;3.4 Exam 1&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html#%28part._assignments%29" title="up to &quot;3 Assignments&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="a5.html" title="forward to &quot;3.6 MIC-1 Calculator&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>