<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>2.18&nbsp;Program Design with Mutation</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default"/><link rel="stylesheet" type="text/css" href="course.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Introduction to Programming (Fall 2011)</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="index.html#%28part._.Introduction%29" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="index.html#%28part._.Meetings%29" class="tocviewselflink" data-pltdoc="x">Meetings</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="index.html#%28part._.Help%29" class="tocviewlink" data-pltdoc="x">Help</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="index.html#%28part._.Course_.Software%29" class="tocviewlink" data-pltdoc="x">Course Software</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="index.html#%28part._recipe%29" class="tocviewlink" data-pltdoc="x">How to Solve Your Problems</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="index.html#%28part._.Assignments_and_.Turn_.In_.Policy%29" class="tocviewlink" data-pltdoc="x">Assignments and Turn In Policy</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="index.html#%28part._.Exams%29" class="tocviewlink" data-pltdoc="x">Exams</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="index.html#%28part._final-grade%29" class="tocviewlink" data-pltdoc="x">Your Final Grade</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="index.html#%28part._.Glossary%29" class="tocviewlink" data-pltdoc="x">Glossary</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="index.html#%28part._.Miscellany%29" class="tocviewlink" data-pltdoc="x">Miscellany</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>2&nbsp;</td><td><a href="index.html#%28part._.Meetings%29" class="tocviewlink" data-pltdoc="x">Meetings</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="1.html" class="tocviewlink" data-pltdoc="x">Introduction to Programming and C+<span class="mywbr"> &nbsp;</span>+</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="2.html" class="tocviewlink" data-pltdoc="x">Expressions and Functions</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="3.html" class="tocviewlink" data-pltdoc="x">Function Composition and Conditionals</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="4.html" class="tocviewlink" data-pltdoc="x">Conditionals and Strings</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="5.html" class="tocviewlink" data-pltdoc="x">Objects</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="6.html" class="tocviewlink" data-pltdoc="x">Objects and Nested Objects</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="7.html" class="tocviewlink" data-pltdoc="x">Methods</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="8.html" class="tocviewlink" data-pltdoc="x">Mixed Data</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="9.html" class="tocviewlink" data-pltdoc="x">Introduction to Lists</a></td></tr><tr><td align="right">2.10&nbsp;</td><td><a href="10.html" class="tocviewlink" data-pltdoc="x">More on Lists</a></td></tr><tr><td align="right">2.11&nbsp;</td><td><a href="11.html" class="tocviewlink" data-pltdoc="x">Producing Lists; Sorting</a></td></tr><tr><td align="right">2.12&nbsp;</td><td><a href="12.html" class="tocviewlink" data-pltdoc="x">Lists of Objects</a></td></tr><tr><td align="right">2.13&nbsp;</td><td><a href="13.html" class="tocviewlink" data-pltdoc="x">More Lists of Objects</a></td></tr><tr><td align="right">2.14&nbsp;</td><td><a href="14.html" class="tocviewlink" data-pltdoc="x">Trees</a></td></tr><tr><td align="right">2.15&nbsp;</td><td><a href="15.html" class="tocviewlink" data-pltdoc="x">Trees and Hierarchy</a></td></tr><tr><td align="right">2.16&nbsp;</td><td><a href="16.html" class="tocviewlink" data-pltdoc="x">More on Hierarchies</a></td></tr><tr><td align="right">2.17&nbsp;</td><td><a href="17.html" class="tocviewlink" data-pltdoc="x">Introduction to Mutation</a></td></tr><tr><td align="right">2.18&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Program Design with Mutation</a></td></tr><tr><td align="right">2.19&nbsp;</td><td><a href="19.html" class="tocviewlink" data-pltdoc="x">Changing Structure Contents</a></td></tr><tr><td align="right">2.20&nbsp;</td><td><a href="20.html" class="tocviewlink" data-pltdoc="x">More on Mutation with Structures</a></td></tr><tr><td align="right">2.21&nbsp;</td><td><a href="21.html" class="tocviewlink" data-pltdoc="x">Deep Dark Secrets of C+<span class="mywbr"> &nbsp;</span>+</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>2.18&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Program Design with Mutation</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.18.1&nbsp;</td><td><a href="#%28part._18_obj%29" class="tocviewlink" data-pltdoc="x">Objectives</a></td></tr><tr><td align="right">2.18.2&nbsp;</td><td><a href="#%28part._18_exer%29" class="tocviewlink" data-pltdoc="x">Exercises (due 2011/<span class="mywbr"> &nbsp;</span>11/<span class="mywbr"> &nbsp;</span>22 08:<span class="mywbr"> &nbsp;</span>45:<span class="mywbr"> &nbsp;</span>00)</a></td></tr><tr><td align="right">2.18.3&nbsp;</td><td><a href="#%28part._18_opt%29" class="tocviewlink" data-pltdoc="x">Optional Exercises (due 2011/<span class="mywbr"> &nbsp;</span>11/<span class="mywbr"> &nbsp;</span>30 08:<span class="mywbr"> &nbsp;</span>45:<span class="mywbr"> &nbsp;</span>00)</a></td></tr><tr><td align="right">2.18.4&nbsp;</td><td><a href="#%28part._18_plan%29" class="tocviewlink" data-pltdoc="x">Notes</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.18.1<tt>&nbsp;</tt></span><a href="#%28part._18_obj%29" class="tocsubseclink" data-pltdoc="x">Objectives</a></td></tr><tr><td><span class="tocsublinknumber">2.18.2<tt>&nbsp;</tt></span><a href="#%28part._18_exer%29" class="tocsubseclink" data-pltdoc="x">Exercises (due 2011/<span class="mywbr"> &nbsp;</span>11/<span class="mywbr"> &nbsp;</span>22 08:<span class="mywbr"> &nbsp;</span>45:<span class="mywbr"> &nbsp;</span>00)</a></td></tr><tr><td><span class="tocsublinknumber">2.18.3<tt>&nbsp;</tt></span><a href="#%28part._18_opt%29" class="tocsubseclink" data-pltdoc="x">Optional Exercises (due 2011/<span class="mywbr"> &nbsp;</span>11/<span class="mywbr"> &nbsp;</span>30 08:<span class="mywbr"> &nbsp;</span>45:<span class="mywbr"> &nbsp;</span>00)</a></td></tr><tr><td><span class="tocsublinknumber">2.18.4<tt>&nbsp;</tt></span><a href="#%28part._18_plan%29" class="tocsubseclink" data-pltdoc="x">Notes</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="17.html" title="backward to &quot;2.17 Introduction to Mutation&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html#%28part._.Meetings%29" title="up to &quot;2 Meetings&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="19.html" title="forward to &quot;2.19 Changing Structure Contents&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>2.18<tt>&nbsp;</tt><a name="(part._18)"></a>Program Design with Mutation</h4><blockquote class="SCentered"><p><span style="font-style: italic">Teenage Mutant Ninja Turtles:</span></p><p><span style="font-style: italic">Turtles in a While Loop</span></p><p><span style="font-style: italic">Set! power</span></p></blockquote><h5>2.18.1<tt>&nbsp;</tt><a name="(part._18_obj)"></a>Objectives</h5><p><div class="SIntrapara">At the end of this class, you should know:</div><div class="SIntrapara"><ul><li><p>what <a href="index.html#%28tech._mutation%29" class="techoutside" data-pltdoc="x"><span class="techinside">mutation</span></a> is</p></li><li><p>the difference between <a href="index.html#%28tech._internal._mutation%29" class="techoutside" data-pltdoc="x"><span class="techinside">internal mutation</span></a> and <a href="index.html#%28tech._external._mutation%29" class="techoutside" data-pltdoc="x"><span class="techinside">external mutation</span></a></p></li><li><p>how to analyze <a href="index.html#%28tech._mutation%29" class="techoutside" data-pltdoc="x"><span class="techinside">mutation</span></a>-based programs with <a href="index.html#%28tech._store._tracking%29" class="techoutside" data-pltdoc="x"><span class="techinside">store tracking</span></a></p></li></ul></div></p><p><div class="SIntrapara">At the end of this class, you should be able:</div><div class="SIntrapara"><ul><li><p>write basic <a href="index.html#%28tech._mutation%29" class="techoutside" data-pltdoc="x"><span class="techinside">mutation</span></a>-based programs, i.e. programs that use <a href="index.html#%28tech._variable%29" class="techoutside" data-pltdoc="x"><span class="techinside">variables</span></a></p></li><li><p>perform <a href="index.html#%28tech._store._tracking%29" class="techoutside" data-pltdoc="x"><span class="techinside">store tracking</span></a> analysis</p></li><li><p>use the <span class="stt">while</span> construct</p></li><li><p>use the <span class="stt">fopen</span> and <span class="stt">getc</span> functions</p></li></ul></div></p><h5>2.18.2<tt>&nbsp;</tt><a name="(part._18_exer)"></a>Exercises (due 2011/11/22 08:45:00)</h5><p>1. Write the function <span class="stt">theRemoveEntry</span>, which takes a name and modifies the address book by removing the associated entries from the book. (Hint: Write without mutation first!)</p><p>2. Write <span class="stt">isPrime</span>, from last exercise, <span style="font-weight: bold">with a while loop</span>.</p><p>3. Create a program called <span class="stt">letterCount</span> that reads a file and prints out how many characters are in it. <span style="font-weight: bold">Write in accumulator style.</span> (Remember the example we did in class!)</p><p>4. Create a program called <span class="stt">wordCount</span> that reads a file and prints out how many words are in it. <span style="font-weight: bold">Write in accumulator style.</span> Remember, words are separated by one or more spaces. You must correctly handle words separated by many spaces. (Hint: The character for a space is &rsquo; &rsquo;.)</p><p>5. Convert <span class="stt">letterCount</span> to <span style="font-weight: bold">use mutation and a while loop</span>.</p><p>6. Convert <span class="stt">wordCount</span> to <span style="font-weight: bold">use mutation and a while loop</span>.</p><h5>2.18.3<tt>&nbsp;</tt><a name="(part._18_opt)"></a>Optional Exercises (due 2011/11/30 08:45:00)</h5><p>7. Write <span class="stt">to10</span>, from last exercise, <span style="font-weight: bold">with a while loop</span>.</p><p>8. Create a program called <span class="stt">lineCount</span> that reads a file and prints out how many lines are in it. <span style="font-weight: bold">Write in accumulator style.</span> (Hint: The character for newlines is &rsquo;\n&rsquo;.)</p><p>9. Convert <span class="stt">lineCount</span> to <span style="font-weight: bold">use mutation and a while loop</span>.</p><h5>2.18.4<tt>&nbsp;</tt><a name="(part._18_plan)"></a>Notes</h5><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>These notes are primarily for my sake, but I don&rsquo;t see any reason to hide them from you.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">Sometimes we can turn accumulator style into mutator style</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">write factorial with a while loop</span></p></td></tr><tr><td><p><span class="stt">-- CLEARLY dervie the mutation version from the functional version</span></p></td></tr><tr><td><p><span class="stt">-- n = n - 1 [do not use --!]</span></p></td></tr><tr><td><p><span class="stt">-- Make sure you have a nice comment that explains the syntax of while</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">change the address book functions to leave the phone-book argument implicit and have add return void. Instead, they will mutator a static variable.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Contrast the two programs: we can do substitution of factorial, but we cannot on the address book functions</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">factorial uses internal mutation, add uses external</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">This means factorial is an abstraction, but add is not</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Mutation makes it so we can no longer analyze our programs in pieces, we have to take in everything at once.</span></p></td></tr><tr><td><p><span class="stt">-- I would use an example where there is a whole bunch of code between two lookups on the same thing, but one returns a number and the other returns "Not found", we have to inspect everything in between to find out what happened</span></p></td></tr><tr><td><p><span class="stt">-- Instead of substitution, we must use "store tracking", where we have to keep track of the store AND the program at the same time, whereas before we could keep track of just the program. Show this with factorial.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Internal mutation is okay, but external mutation is DANGEROUS, how do we tame it?</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Write a traffic light simulator with a color and a function 'next' that goes green -&gt; yellow -&gt; red -&gt; green -&gt; ...</span></p></td></tr><tr><td><p><span class="stt">-- Write in accumulator style, then port</span></p></td></tr><tr><td><p><span class="stt">-- Use this as the way of discussing the design of external mutation-based functions</span></p></td></tr><tr><td><p><span class="stt">-- Tests cases aren't simple, because they have to mention the state variable (if color is "green", then after next(), color is "yellow" --- not the same as next("green") == "yellow")</span></p></td></tr><tr><td><p><span class="stt">-- Instead, our test cases must look like:</span></p></td></tr><tr><td><p><span class="stt">---------- // Pre condition</span></p></td></tr><tr><td><p><span class="stt">---------- color = "green";</span></p></td></tr><tr><td><p><span class="stt">---------- // Test</span></p></td></tr><tr><td><p><span class="stt">---------- next();</span></p></td></tr><tr><td><p><span class="stt">---------- // Post condition</span></p></td></tr><tr><td><p><span class="stt">---------- printf("The answer is %s, but should be %s\n", color, "yellow");</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Some built-in Java functions use mutation. For example, getc</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">#include &lt;stdio.h&gt;</span></p></td></tr><tr><td><p><span class="stt">int main() {</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">FILE* f = fopen("18.cc", "r");</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">printf("The answer is %c, but should be %c\n", getc(f), '#');</span></p></td></tr><tr><td><p><span class="stt">}</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">// You must explain that %c means "character", which is an integer (like 64) interpreted as a letter (like 'a'). C syntactic minutiae: Notice that single characters use single quotes, not double quotes, like strings.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">This succeeds, "The answer is i, but should be i"</span></p></td></tr><tr><td><p><span class="stt">If we try this test case again,</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">printf("The answer is %c, but should be %c\n", getc(f), '#');</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">It fails, "The answer is i, but should be #"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">// More minutate, if getc() ever returns -1, that means the file is over. It will return -1 from that time on.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">That means getc uses mutation.</span></p></td></tr></table></div></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="17.html" title="backward to &quot;2.17 Introduction to Mutation&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html#%28part._.Meetings%29" title="up to &quot;2 Meetings&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="19.html" title="forward to &quot;2.19 Changing Structure Contents&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>