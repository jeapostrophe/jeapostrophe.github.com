<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>2013-06-17: SRAM Hacking in Racket</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--><link href="atom.xml" rel="alternate" title="Jay McCarthy" type="application/atom+xml"/><script type="text/javascript">var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30131476-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();</script></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Jay Mc<span class="mywbr"> &nbsp;</span>Carthy</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="cat-categories.html" class="tocviewlink" data-pltdoc="x">Categories</a></td></tr><tr><td align="right"></td><td><a href="archive.html" class="tocviewselflink" data-pltdoc="x">Archive</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;">&bull;</td><td></td><td><a href="archive.html" class="tocviewlink" data-pltdoc="x">Archive</a></td></tr></table></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">2013-<wbr></wbr>06-<wbr></wbr>17:<span class="mywbr"> &nbsp;</span> SRAM Hacking in Racket</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.What_is_.Final_.Fantasy_5_%29" class="tocviewlink" data-pltdoc="x">What is Final Fantasy 5?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.What_does_the_program_do_%29" class="tocviewlink" data-pltdoc="x">What does the program do?</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.What_must_the_program_deal_with_%29" class="tocviewlink" data-pltdoc="x">What must the program deal with?</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.How_does_it_work_%29" class="tocviewlink" data-pltdoc="x">How does it work?</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.How_do_you_compute_the_checksum_%29" class="tocviewlink" data-pltdoc="x">How do you compute the checksum?</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._.Yo__.It_s_almost_time_to_go_%29" class="tocviewlink" data-pltdoc="x">Yo! It&rsquo;s almost time to go!</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.What_does_the_program_do_%29" class="tocsubseclink" data-pltdoc="x">What does the program do?</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.What_must_the_program_deal_with_%29" class="tocsubseclink" data-pltdoc="x">What must the program deal with?</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.How_does_it_work_%29" class="tocsubseclink" data-pltdoc="x">How does it work?</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3csave-slot~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;save-slot&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cchecksum~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cchar-slot~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;char-slot&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cabp-offset~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;abp-offset&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cmodify~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;modify&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.How_do_you_compute_the_checksum_%29" class="tocsubseclink" data-pltdoc="x">How do you compute the checksum?</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cchecksum-calc~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum-calc&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cwrite-check~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;write-check&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cabp-hack~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;abp-hack&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.Yo__.It_s_almost_time_to_go_%29" class="tocsubseclink" data-pltdoc="x">Yo! It&rsquo;s almost time to go!</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3c%2A~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;*&gt;</a></span></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="2013-06-10-csproble-post.html" title="backward to &quot;2013-06-10: Computer Science &amp; Problem Solving&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="archive.html" title="up to &quot;Archive&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="2013-06-24-cas-cad--post.html" title="forward to &quot;2013-06-24: Cascading Switches in Racket&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4><a name="(part._post)"></a>2013-06-17: SRAM Hacking in Racket</h4><div class="SAuthorListBox"><span class="SAuthorList"><p class="author"><a href="index.html" data-pltdoc="x">Jay McCarthy</a></p></span></div><p><div class="SIntrapara"></div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>The source for this post is online at <a href="https://github.com/jeapostrophe/jeapostrophe.github.com/tree/source/posts/2013-06-17-ff5.rkt">2013-06-17-ff5.rkt</a>.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara"><span style="font-weight: bold">Categories:</span> <a href="cat-categories.html#%28part._.Racket%29" data-pltdoc="x">Racket</a> <a href="cat-categories.html#%28part._.Games%29" data-pltdoc="x">Games</a> </div></p><p>As I&rsquo;ve mentioned before, I like playing video games and especially
old video games. I was recently playing Final Fantasy 5 and wrote a
little program to help me. This program is interesting, because it
performs a very low-level, bit-oriented task you might normally
associate with C.</p><blockquote class="SCentered"><p>-</p></blockquote><h5>1<tt>&nbsp;</tt><a name="(part._.What_is_.Final_.Fantasy_5_)"></a>What is Final Fantasy 5?</h5><p><a href="http://en.wikipedia.org/wiki/Final_fantasy">Final Fantasy</a> is
a series of role-playing games from the Japanese company Square (now
Square Enix). Since the first in 1987, they&rsquo;ve been defined by their
epic stories and technical prowess. Each game is distinct others: they
aren&rsquo;t set in the same universe and they don&rsquo;t have the same gameplay
mechanics, except in very broad strokes. Thus, Final Fantasy is a pure
<span style="font-style: italic">brand</span>: when you buy one, you are just buying the product
of "the team," which has changed so much that it&rsquo;s just a label of
quality from Square.</p><p>Since Square is a Japanese company, its games have always been written
in Japanese originally and then translated to English. During the
early 1990s, it was not a given that a game would be translated. For
example, <a href="http://en.wikipedia.org/wiki/Final_Fantasy_2">Final
Fantasy 2</a>,
<a href="http://en.wikipedia.org/wiki/Final_Fantasy_III">Final Fantasy
3</a>, and <a href="http://en.wikipedia.org/wiki/Final_Fantasy_V">Final
Fantasy 5</a> were not released in America. (Instead,
<a href="http://en.wikipedia.org/wiki/Final_Fantasy_IV">Final Fantasy
4</a> was released as <span style="font-style: italic">Final Fantasy 2</span> and
<a href="http://en.wikipedia.org/wiki/Final_Fantasy_VI">Final Fantasy
6</a> as <span style="font-style: italic">Final Fantasy 3</span>. When
<a href="http://en.wikipedia.org/wiki/Final_Fantasy_VII">Final Fantasy
7</a> was released in America, it kept its natural number.)</p><p>In October 1998, fans hacked the SNES ROM of Final Fantasy 5 to
translate it into English and released
<a href="http://www.romhacking.net/translations/353/">a patch</a> so
anyone could play it. This was the first RPG to be fully translated
and I remember hearing about it immediately. I played it a little when
I was young, but didn&rsquo;t really get into it fully.</p><p>Fast-forward fifteen years, I decided to play it through.</p><h5>2<tt>&nbsp;</tt><a name="(part._.What_does_the_program_do_)"></a>What does the program do?</h5><p>The game features a system where you need to fight monsters to gain
points that increase your power and abilities. There are three kinds
of points: experience that makes you stronger, gil which gives you
purchasing power, and ability points which unlock more skills. In
general, in each battle you will get a lot of experience, a moderate
amount of gil, and a tiny amount of ability points. It&rsquo;s strange,
because the thing which is the least useful (just getting a new
ability), the game is incredibly stingy on dolling out.</p><p>Since it is so stingy, I made a meticulous plan for how I would use my
ability points so I wouldn&rsquo;t get any useless abilities. I played for
about fifteen hours and then reached a point in the game where I had
the ideal place to gain ability points. I had about half of the
abilities I planned on and needed about 1,000 more points.</p><p><div class="SIntrapara">My ideal place allowed me to go on a little cycle:
</div><div class="SIntrapara"><ul><li><p>Go to an area with only one kind of enemy.</p></li><li><p>Get in a fight, either against 2 of them or 5 of them.</p></li><li><p>Have the first character who can attack, and who always attacks before the enemies, use a certain spell that always immediately kills them all.</p></li><li><p>Based on the cost of the spell, this allows 8 fights before needing to get more magic power.</p></li><li><p>Use an item that costs 600 Gil to heal.</p></li><li><p>Repeat.</p></li></ul></div></p><p>This process has no risk, because the spell always works and there&rsquo;s
only one kind of enemy. If I assume equal numbers of two and five
enemy battles, it gives me the following every cycle:</p><ul><li><p>700 experience</p></li><li><p>13,596 gil</p></li><li><p>48 ability points</p></li></ul><p>Given that I had a discovered a way to exploit the game and get
infinite resources, there was only time between me and my goal.</p><p>Before reaching 1,000 points to go, I did this cycle for about two
hours while watching a movie with my wife and did about 10 cycles, or
got about 500 points. Interestingly, this is not a significant source
of experience but it is a major source of gil, which is uncommon. So,
getting to my goal would take about four hours.</p><p>I wish I could submit a proof to the game or at least write a program
that would play automatically and get what I wanted, but it is
impractical to do either of those things.</p><p>Instead, I felt justified in cheating and just giving myself what I
wanted: the 1,000 ability points. As a punishment for not actually
playing, I wouldn&rsquo;t give myself the gil or experience I would earn in
the course of getting the ability points.</p><h5>3<tt>&nbsp;</tt><a name="(part._.What_must_the_program_deal_with_)"></a>What must the program deal with?</h5><p>Super Nintendo games are each a unique piece of hardware connects
electrically to the Super Nintendo and can implement arbitrarily
behavior. They&rsquo;ve basically just like expansion cards for PCs. (Some
games had powerful additional compute power on them. For instance,
<a href="http://en.wikipedia.org/wiki/Super_Mario_RPG:_Legend_of_the_Seven_Stars">Super
Mario RPG</a> contained the
<a href="http://en.wikipedia.org/wiki/Nintendo_SA-1#SA1">Nintendo SA1</a>
which was an upgrade SNES CPU.)</p><p>However, most games were just a giant ROM chip array where the program
and its data were stored. In games like Final Fantasy where you would
play over many sessions, they needed to have an additional place to
save data that would persist across disconnects. Typically there would
be a RAM chip with a battery connected to it that would safe the
data. The size of these chips is typically very small, because of the
expensive and the drain on the battery. (These batteries a <span style="font-style: italic">not</span>
designed to be replaced. I have many games from the early 1990s where
the battery has never been changed and still works. Nevertheless,
<a href="http://www.racketboy.com/retro/how-to-change-snes-game-save-battery">it
is possible to replace them</a>.)</p><p>Final Fantasy 5 works just like this and it&rsquo;s where your saves are
stored. If I were using an <a href="http://byuu.org/higan/">emulator</a>,
it would be trivial to get the save RAM, but I always use a real SNES
when I play my games. Luckily, the
<a href="http://www.retrode.org/">Retrode</a> can read the save RAM and
write it back on to the game.</p><p>My program modifies the save RAM to increase the number of ability
points each character has. I just dumped the RAM, ran the program, and
then put the RAM back on the cart.</p><h5>4<tt>&nbsp;</tt><a name="(part._.How_does_it_work_)"></a>How does it work?</h5><p>Since Final Fantasy 5 was previously hacked to do a translation, how
its binary code works is well understood and
<a href="http://wiki.superfamicom.org/snes/show/Final+Fantasy+5">documented</a>. Including
the arrangement of the save data.</p><p>The save data is 8 KiB and divided into 5 parts.</p><p>The first four are the four save slots and are <span class="RktVal">1792</span> bytes
apart, although only <span class="RktVal">1536</span> bytes are used.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3csave-slot~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3csave-slot~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;save-slot&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">save-slot-start</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" class="RktStxLink" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3c%29%29" class="RktValLink" data-pltdoc="x">&lt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ff5</span><span class="hspace">&nbsp;</span><span class="RktVal">"There are only four save slots"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">1792</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>The last part, which starts at <span class="RktVal">8176</span> holds a table of
checksums to determine if each save slot is corrupted.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cchecksum~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cchecksum~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">checksum-offset</span><span class="hspace">&nbsp;</span><span class="RktVal">8176</span><span class="RktPn">)</span></p></blockquote></div></p><p>The most complicated thing will be to fix this checksum afterwards.</p><p>Inside a save slot, there are four uniform blocks for information
about each character. They are stored first in the save slot and are
<span class="RktVal">80</span> bytes large.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cchar-slot~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cchar-slot~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;char-slot&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">char-slot-offset</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" class="RktStxLink" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3c%29%29" class="RktValLink" data-pltdoc="x">&lt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ff5</span><span class="hspace">&nbsp;</span><span class="RktVal">"There are only four characters"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">80</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>Inside of each of these slots, at byte <span class="RktVal">59</span>, is a 16-bit
number recording the number of ability points the character
has. Despite being 16-bits, the game only recognizes values up to 999.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cabp-offset~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cabp-offset~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;abp-offset&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">abp-offset</span><span class="hspace">&nbsp;</span><span class="RktVal">59</span><span class="RktPn">)</span></p></blockquote></div></p><p>Given all this, it is trivial to modify every character, assuming the
SRAM is loaded as a byte string into <span class="RktSym">sram</span>, because
<span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._integer-~3einteger-bytes%29%29" class="RktValLink" data-pltdoc="x">integer-&gt;integer-bytes</a></span> and <span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._integer-bytes-~3einteger%29%29" class="RktValLink" data-pltdoc="x">integer-bytes-&gt;integer</a></span>
allow you to observe the actual bytes for a number with support for
reading and writing to pieces of byte strings.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cmodify~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cmodify~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;modify&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">save-start</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">save-slot-start</span><span class="hspace">&nbsp;</span><span class="RktSym">which-save</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%29%29" class="RktStxLink" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-range%29%29" class="RktValLink" data-pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">char-start</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">char-slot-offset</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">this-abp-offset</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">save-start</span><span class="hspace">&nbsp;</span><span class="RktSym">char-start</span><span class="hspace">&nbsp;</span><span class="RktSym">abp-offset</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" class="RktValLink" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"~a: ~a -&gt; 999\n"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">i</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._integer-bytes-~3einteger%29%29" class="RktValLink" data-pltdoc="x">integer-bytes-&gt;integer</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sram</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">signed?</span><span class="hspace">&nbsp;</span><span class="RktSym">big-endian?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">this-abp-offset</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">this-abp-offset</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._integer-~3einteger-bytes%29%29" class="RktValLink" data-pltdoc="x">integer-&gt;integer-bytes</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">999</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">signed?</span><span class="hspace">&nbsp;</span><span class="RktSym">big-endian?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sram</span><span class="hspace">&nbsp;</span><span class="RktSym">this-abp-offset</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>But, if you just do this, then the game will reject the save and
delete it, because the checksum is wrong.</p><h5>5<tt>&nbsp;</tt><a name="(part._.How_do_you_compute_the_checksum_)"></a>How do you compute the checksum?</h5><p>The checksum is a 16-bit number for each save. It is based on summing
the whole <span class="RktVal">1536</span> byte region for the save as 16-bit
numbers. The complicated part of implementing this in Racket is that
when running on the
<a href="http://en.wikipedia.org/wiki/Ricoh_5A22">Ricoh 5A22</a>, the
carry bit is accumulated which each addition and that needs to be
accounted for. Similarly, you have to account for 16-bit overflow when
working in Racket with infinite precision integers.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cchecksum-calc~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cchecksum-calc~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum-calc&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28quote._~23~25kernel%29._define-values%29%29" class="RktStxLink" data-pltdoc="x">define-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">final-checksum</span><span class="hspace">&nbsp;</span><span class="RktSym">final-carry</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Ffold%29%29" class="RktStxLink" data-pltdoc="x">for/fold</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">aw</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">carry</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-range%29%29" class="RktValLink" data-pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2F%29%29" class="RktValLink" data-pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1536</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">word-start</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">save-start</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rw</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._integer-bytes-~3einteger%29%29" class="RktValLink" data-pltdoc="x">integer-bytes-&gt;integer</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sram</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">signed?</span><span class="hspace">&nbsp;</span><span class="RktSym">big-endian?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">word-start</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">word-start</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">maybe-overflowed-checksum</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">aw</span><span class="hspace">&nbsp;</span><span class="RktSym">rw</span><span class="hspace">&nbsp;</span><span class="RktSym">carry</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">new-checksum</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._modulo%29%29" class="RktValLink" data-pltdoc="x">modulo</a></span><span class="hspace">&nbsp;</span><span class="RktSym">maybe-overflowed-checksum</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._expt%29%29" class="RktValLink" data-pltdoc="x">expt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym">new-checksum</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">new-checksum</span><span class="hspace">&nbsp;</span><span class="RktSym">maybe-overflowed-checksum</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>After we&rsquo;ve calculated it, we just write it:</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cwrite-check~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cwrite-check~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;write-check&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">checksum-start</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">checksum-offset</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">which-save</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._integer-~3einteger-bytes%29%29" class="RktValLink" data-pltdoc="x">integer-&gt;integer-bytes</a></span><span class="hspace">&nbsp;</span><span class="RktSym">final-checksum</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">signed?</span><span class="hspace">&nbsp;</span><span class="RktSym">big-endian?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sram</span><span class="hspace">&nbsp;</span><span class="RktSym">checksum-start</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>When we put all this together in a function, it looks like:</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cabp-hack~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cabp-hack~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;abp-hack&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">abp-hack</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">which-save</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sram</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Filesystem.html#%28def._%28%28lib._racket%2Ffile..rkt%29._file-~3ebytes%29%29" class="RktValLink" data-pltdoc="x">file-&gt;bytes</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3cmodify~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;modify&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3cchecksum-calc~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum-calc&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3cwrite-check~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;write-check&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Filesystem.html#%28def._%28%28lib._racket%2Ffile..rkt%29._display-to-file%29%29" class="RktValLink" data-pltdoc="x">display-to-file</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sram</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktPn">#:exists</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">replace</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>When I first did this, I had accidentally defined the endianness
incorrectly. I found a C++ version of this calculation
<a href="https://github.com/pbiernat/mu/blob/master/mu.cpp">online</a>,
but it has an error because it doesn&rsquo;t abstract from the endianness of
the machine it runs on. In addition, I think it is more complicated.</p><p>This program took me about 90 minutes to write, including reading
about the SRAM layout and working out all the little problems, like
endianness. I took about 8 minutes to actually do the dump/run/etc
cycle and get the points that I wanted.</p><p>Success!</p><h5>6<tt>&nbsp;</tt><a name="(part._.Yo__.It_s_almost_time_to_go_)"></a>Yo! It&rsquo;s almost time to go!</h5><p>But first let&rsquo;s remember what we learned today!</p><p>Since Racket has hexadecimal literals, integer byte operations, and
convenient abstractions for endianness and byte length, it is an
excellent choice for low-level modification of 16-bit binary data.</p><p>And, with the power of programming, you can save yourself from 4 hours
of mindless grinding with just 1.5 hours of entertaining programming.</p><p>If you&rsquo;d like to run this exact code at home, you should put it in
this order:</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3c*~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3c%2A~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;*&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/file</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3csave-slot~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;save-slot&gt;</a></td></tr><tr><td><a href="#%28elem._%28chunk._~3cchecksum~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum&gt;</a></td></tr><tr><td><a href="#%28elem._%28chunk._~3cchar-slot~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;char-slot&gt;</a></td></tr><tr><td><a href="#%28elem._%28chunk._~3cabp-offset~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;abp-offset&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">signed?</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">big-endian?</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3cabp-hack~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;abp-hack&gt;</a></td></tr></table></blockquote></div></p><p><div id="disqus_thread"><script type="text/javascript">
var disqus_shortname = 'jaymccarthy';
var disqus_identifier = 'http://jeapostrophe.github.com/blog/2013/06/17/ff5/';
var disqus_url = 'http://jeapostrophe.github.com/2013-06-17-ff5-post.html';
var disqus_script = 'embed.js';
(function () {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());

</script><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="2013-06-10-csproble-post.html" title="backward to &quot;2013-06-10: Computer Science &amp; Problem Solving&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="archive.html" title="up to &quot;Archive&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="2013-06-24-cas-cad--post.html" title="forward to &quot;2013-06-24: Cascading Switches in Racket&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>